{"version":3,"sources":["containers/Search.js","store/locationStore.js","images/logo.svg","images/ic-search.svg","images/ic-map-pin.svg","images/ic-alert.svg","images/ic-search-grey.svg","images/ic-bus-main.svg","images/empty-card.svg","images/dashed-line.svg","const.js","style.js","components/Menu.js","images/ic-point.svg","images/ic-map-marker.svg","common.js","components/QuickSearch.js","components/SearchSelect.js","components/Empty.js","components/StationModal.js","images/user-marker.svg","images/ic-map-marker-main.svg","containers/Nearby.js","containers/News.js","App.js","reportWebVitals.js","index.js"],"names":["map","LocationContext","createContext","useLocationStore","useContext","LocationContextProvider","children","React","useState","locationData","setLocationData","Provider","value","desktopMedia","styles","colors","directionText","E","W","S","N","SE","NE","SW","NW","auth","process","cities","name","key","latlng","lat","lng","Container","styled","div","PageWrapper","PageTitle","h1","SecondTitle","h2","ItemTitle","h3","TitleSplit","hr","Board","StripedList","ul","StopsStripedList","StopStatus","span","BusPlate","icBus","TabList","size","MenuWrapper","LinkLogo","Link","NavList","NavListItem","li","NavLink","Overlay","ModalWrapper","Modal","MapContainer","SearchInput","input","icSearch","DropdownWrapper","DropdownList","DropdownListItem","EmptyWrapper","emptyBg","EmptyText","TitleWithSearch","SearchWrapper","SearchCol1","SearchCol2","ClockText","SearchFieldWrapper","dashedBorder","SearchBtn","button","RouteMap","Menu","to","src","Logo","icMapPin","icAlert","useIsMobile","isMobileSize","setIsMobileSize","useEffect","window","autoResize","innerWidth","addEventListener","removeEventListener","genHMAC","GMTString","Date","toGMTString","ShaObj","jsSHA","setHMACKey","update","HMAC","getHMAC","commonAxios","a","method","url","others","responseData","axios","responseType","headers","Authorization","data","console","log","StyledSelect","navigate","useNavigate","options","setOptions","showDropdown","setShowDropdown","inputRef","useRef","root","document","getElementById","onOtherClick","e","target","current","length","ref","type","placeholder","onChange","keyword","then","res","n","RouteUID","label","RouteName","Zh_tw","sort","b","localeCompare","onFocus","opt","onClick","val","SearchSelect","onSelect","icon","inputValue","setInputValue","filterOptions","setFilterOptions","alt","filter","includes","autocomplete","option","Empty","text","statusMap","L","NumberedIcon","Icon","extend","number","className","iconAnchor","popupAnchor","createIcon","createElement","innerHTML","this","_setIconStyles","initMap","ele","wkt","stops","lineData","GeoJSON","coordsToLatLngs","parseWKT","coordinates","l","polyline","color","bounds","getBounds","center","getCenter","mymap","zoomControl","setView","layerGroup","addTo","tileLayer","attribution","maxZoom","id","tileSize","zoomOffset","accessToken","forEach","s","i","StopPosition","PositionLat","PositionLon","marker","StopSequence","bindPopup","StopName","fitBounds","Search","useParams","urlCity","city","urlRoute","route","clock","setClock","mapInitialized","setMapInitialized","filterConfig","setFilterConfig","currentRoute","setCurrentRoute","routeOptions","setRouteOptions","stopsList","setStopsList","activeList","setActiveList","routeShape","setRouteShape","isMobile","getStops","Promise","all","results","routeInfos","routeStops","routeRealNearStop","estimatedArrival","shapes","routeInfo","subRoutes","destination","Direction","DestinationStopNameZh","DepartureStopNameZh","bus","subRouteIndex","findIndex","SubRouteUID","Stops","PlateNumb","busStatus","DutyStatus","stop","estimateTime","EstimateTime","parseInt","stopIndex","StopUID","status","Geometry","moment","format","timer","setInterval","clearInterval","remove","currentCity","find","City","QuickSearch","style","padding","overflow","fontFamily","fontSize","marginBottom","v","icPoint","icMapMarker","list","StopID","StationModal","close","config","iconUrl","mapMarker","userMarker","StationPosition","stopPropagation","StationName","Bearing","join","Nearby","currentDistance","setCurrentDistance","setData","modalInfo","setModalInfo","getPosition","navigator","geolocation","getCurrentPosition","coords","latitude","longitude","useCurrentPosition","distance","arr","x","StationID","getNearStations","marginTop","info","preventDefault","showModal","StationUID","Layout","App","path","element","index","News","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.892c8f1d.chunk.js","sourcesContent":["import React from 'react';\r\nimport L from 'leaflet';\r\nimport parseWKT from 'wellknown';\r\nimport { useParams, useNavigate } from 'react-router';\r\nimport icPoint from '@/images/ic-point.svg';\r\nimport icMapMarker from '@/images/ic-map-marker.svg';\r\nimport QuickSearch from '@/components/QuickSearch';\r\nimport SearchSelect from '@/components/SearchSelect';\r\nimport Empty from \"@/components/Empty\";\r\nimport {PageTitle, TitleSplit, TitleWithSearch, Board, SecondTitle, RouteMap,\r\n  SearchWrapper, SearchCol1, SearchCol2, ClockText, TabList, StopsStripedList, StopStatus, BusPlate, SearchBtn} from '@/style';\r\nimport {commonAxios, useIsMobile} from '@/common';\r\nimport {auth, colors, cities} from '@/const';\r\nimport moment from 'moment';\r\n\r\nconst statusMap = {0:'正常',1:'尚未發車',2:'交管不停靠',3:'末班車已過',4:'今日未營運'};\r\n\r\nL.NumberedIcon = L.Icon.extend({\r\n\toptions: {\r\n    number: '',\r\n    className: 'icon-number',\r\n    iconAnchor: [12, 12],\r\n    popupAnchor: [0, -12]\r\n\t},\r\n\r\n\tcreateIcon: function () {\r\n\t\tvar div = document.createElement('div');\r\n\t\tdiv.innerHTML = this.options['number'] || '';\r\n\t\tthis._setIconStyles(div, 'icon');\r\n\t\treturn div;\r\n\t},\r\n});\r\n\r\nlet map;\r\n\r\nconst initMap = (ele, wkt, stops = []) => {\r\n  const lineData = L.GeoJSON.coordsToLatLngs(parseWKT(wkt).coordinates);\r\n  const l = L.polyline(lineData, {color: colors.light});\r\n  const bounds = l.getBounds();\r\n  const center = bounds.getCenter();\r\n  const mymap = L.map(ele, {zoomControl: false}).setView([center.lat, center.lng], 15);\r\n  const layerGroup = L.layerGroup().addTo(mymap);\r\n  L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {\r\n    attribution: 'Map data &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, Imagery © <a href=\"https://www.mapbox.com/\">Mapbox</a>',\r\n    maxZoom: 18,\r\n    id: 'allychen/ckw5waap41dl514o4rcpa1nsn',\r\n    tileSize: 512,\r\n    zoomOffset: -1,\r\n    accessToken: auth.mapBoxToken\r\n  }).addTo(mymap);\r\n  l.addTo(mymap);\r\n\r\n  stops.forEach((s, i) => {\r\n    const { PositionLat, PositionLon } = s.StopPosition;\r\n    const marker = L.marker([PositionLat, PositionLon], {\r\n      icon: new L.NumberedIcon({number: s.StopSequence})\r\n    }).addTo(layerGroup);\r\n    marker.bindPopup(s.StopName.Zh_tw);\r\n  });\r\n\r\n  mymap.fitBounds(bounds);\r\n  return mymap;\r\n};\r\n\r\nconst Search = () => {\r\n  const ref = React.useRef();\r\n  const navigate = useNavigate();\r\n  const {city: urlCity, route: urlRoute} = useParams();\r\n  const [clock, setClock] = React.useState('');\r\n  const [mapInitialized, setMapInitialized] = React.useState(false);\r\n  const [filterConfig, setFilterConfig] = React.useState(null);\r\n  const [currentRoute, setCurrentRoute] = React.useState(null);\r\n  const [routeOptions, setRouteOptions] = React.useState([]);\r\n  const [stopsList, setStopsList] = React.useState([]);\r\n  const [activeList, setActiveList] = React.useState(0);\r\n  const [routeShape, setRouteShape] = React.useState('');\r\n  const isMobile = useIsMobile();\r\n\r\n  const getStops = (city, route) => {\r\n    Promise.all([\r\n      commonAxios({\r\n        url: `/v2/Bus/Route/City/${city}?$filter=RouteUID eq '${route}'`,\r\n      }),\r\n      commonAxios({\r\n        url: `/v2/Bus/StopOfRoute/City/${city}?$filter=RouteUID eq '${route}'`,\r\n      }),\r\n      commonAxios({\r\n        url: `/v2/Bus/RealTimeByFrequency/City/${city}?$filter=RouteUID eq '${route}'`,\r\n      }),\r\n      commonAxios({\r\n        url: `/v2/Bus/RealTimeNearStop/City/${city}?$filter=RouteUID eq '${route}'`,\r\n      }),\r\n      commonAxios({\r\n        url: `/v2/Bus/EstimatedTimeOfArrival/City/${city}?$filter=RouteUID eq '${route}'`,\r\n      }),\r\n      commonAxios({\r\n        url: `/v2/Bus/Shape/City/${city}?$filter=RouteUID eq '${route}'`,\r\n      }),\r\n    ]).then((results) => {\r\n      const [routeInfos, routeStops, routeRealPoint, routeRealNearStop, estimatedArrival, shapes] = results;\r\n\r\n      const routeInfo = routeInfos[0];\r\n      setCurrentRoute(routeInfo);\r\n\r\n      const subRoutes = routeStops.map((n) => ({\r\n        ...n,\r\n        destination: n.Direction === 0 ? routeInfo.DestinationStopNameZh : routeInfo.DepartureStopNameZh\r\n      }));\r\n\r\n      if (routeRealNearStop.length > 0) {\r\n        routeRealNearStop.forEach((bus) => {\r\n          const subRouteIndex = subRoutes.findIndex((n) => n.Direction === bus.Direction && n.SubRouteUID === bus.SubRouteUID);\r\n          if (subRouteIndex > -1) {\r\n            subRoutes[subRouteIndex].Stops[bus.StopSequence - 1].BusPlate = bus.PlateNumb;\r\n            subRoutes[subRouteIndex].Stops[bus.StopSequence - 1].busStatus = bus.DutyStatus;\r\n          }\r\n        });\r\n      }\r\n      estimatedArrival.forEach((stop) => {\r\n        const estimateTime = stop.EstimateTime ? parseInt(stop.EstimateTime/60) : 0;\r\n        const subRouteIndex = subRoutes.findIndex((n) => (stop.Direction === 255 && n.SubRouteUID === stop.SubRouteUID) ||\r\n        (n.Direction === stop.Direction && n.RouteUID === stop.RouteUID));\r\n\r\n        const stopIndex = subRoutes[subRouteIndex]?.Stops.findIndex((n) => n.StopUID === stop.StopUID);\r\n        if (stopIndex > -1) {\r\n          subRoutes[subRouteIndex].Stops[stopIndex].status = stop.StopStatus ? statusMap[stop.StopStatus]\r\n          : `${estimateTime > 1 ? `約${estimateTime}分` : '進站中'}`;\r\n        }\r\n        if (subRoutes[subRouteIndex]?.Stops[stopIndex]?.busStatus === 1) {\r\n          subRoutes[subRouteIndex].Stops[stopIndex].status = '進站中';\r\n        }\r\n      });\r\n      if (!routeShape) {\r\n        setRouteShape(shapes[0].Geometry);\r\n      }\r\n      setStopsList(subRoutes.filter((n, i) => i < 2));\r\n      // console.log('routeInfo', routeInfo);\r\n      // console.log('routeStops', routeStops);\r\n      // console.log('routeRealNearStop', routeRealNearStop);\r\n      // console.log('routeRealPoint', routeRealPoint);\r\n      // console.log('estimatedArrival', estimatedArrival);\r\n    });\r\n  };\r\n\r\n  const onSearch = () => {\r\n    const {city, route} = filterConfig;\r\n    navigate(`/search/${city}/${route}`);\r\n  };\r\n\r\n  const onSelectCity = (city) => {\r\n    setFilterConfig({...filterConfig, city});\r\n    commonAxios({\r\n      url: `/v2/Bus/Route/City/${city}?`,\r\n    }).then((res) => {\r\n      setRouteOptions(res?.map((n) => ({value: n.RouteUID, label: n.RouteName.Zh_tw})).sort((a, b) => a.label.localeCompare(b.label)));\r\n    });\r\n  };\r\n\r\n  const OnTabClick = (key) => {\r\n    setActiveList(key);\r\n    // map.remove();\r\n    // map = initMap(ref.current, routeShape, stopsList[key].Stops);\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    if (!clock) {\r\n      setClock(moment(new Date()).format('HH:mm'));\r\n    }\r\n    const timer = setInterval(() => {\r\n      setClock(moment(new Date()).format('HH:mm'));\r\n    }, 2000);\r\n    return () => {\r\n      clearInterval(timer);\r\n    }\r\n  }, [clock]);\r\n\r\n  React.useEffect(() => {\r\n    const timer = setInterval(() => {\r\n      if (urlCity && urlRoute) {\r\n        getStops(urlCity, urlRoute);\r\n      }\r\n    }, 10000);\r\n    return () => {\r\n      clearInterval(timer);\r\n    }\r\n  }, [clock, urlCity, urlRoute]);\r\n\r\n  \r\n  React.useEffect(() => {\r\n    if (!mapInitialized && stopsList.length > 0 && routeShape) {\r\n      map = initMap(ref.current, routeShape, stopsList[activeList].Stops);\r\n      setMapInitialized(true);\r\n      console.log('gogo');\r\n    }\r\n  }, [routeShape, stopsList]);\r\n\r\n  React.useEffect(() => {\r\n    if (mapInitialized) {\r\n      map = initMap(ref.current, routeShape, stopsList[activeList].Stops);\r\n    }\r\n    return () => {\r\n      if (map) {\r\n        map.remove();\r\n      }\r\n    }\r\n  }, [activeList]);\r\n\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (map) {\r\n        map.remove();\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  React.useEffect(() => {\r\n    if (urlCity && urlRoute) {\r\n      getStops(urlCity, urlRoute);\r\n      setRouteShape('');\r\n    } else {\r\n      setCurrentRoute(null)\r\n    }\r\n  }, [urlCity, urlRoute]);\r\n\r\n  const currentCity = cities.find((n) => n.key === currentRoute?.City)?.name;\r\n\r\n  return (\r\n    <>\r\n      <TitleWithSearch>\r\n        <QuickSearch />\r\n        <PageTitle>Route Search <TitleSplit /> {currentRoute ? `${currentCity} - ${currentRoute.RouteName.Zh_tw}` : ' 路線搜尋 '}</PageTitle>\r\n      </TitleWithSearch>\r\n      <SearchWrapper>\r\n        <SearchCol1>\r\n          <div>\r\n            <Board style={{padding: isMobile ? '30px 30px 20px' : '40px 30px 30px', overflow: 'visible'}}>\r\n              <SecondTitle style={{fontFamily: 'DM Sans, Roboto, sans-serif', fontSize: 24, marginBottom: '0.5em'}}>Where are you going?</SecondTitle>\r\n              <SearchSelect\r\n                options={cities.map((n) => ({label: n.name, value: n.key}))}\r\n                placeholder=\"選擇 縣市\"\r\n                onSelect={(v) => onSelectCity(v)}\r\n                icon={icPoint}\r\n              />\r\n              <SearchSelect\r\n                options={routeOptions}\r\n                placeholder=\"選擇 路線\"\r\n                onSelect={(v) => setFilterConfig({...filterConfig, route: v})}\r\n                icon={icMapMarker}\r\n              />\r\n              <SearchBtn onClick={onSearch} type=\"button\">搜尋</SearchBtn>\r\n            </Board>\r\n          </div>\r\n          <div>\r\n            {urlCity && urlRoute ? (\r\n              <Board>\r\n                <TabList size=\"small\">\r\n                  {stopsList.map((list, i) => (\r\n                    <li key={`${list.Direction}-${list.SubRouteUID}`} className={activeList === i ? 'active' : ''} onClick={() => OnTabClick(i)}>\r\n                      往 {list?.destination}\r\n                    </li>\r\n                  ))}\r\n                </TabList>\r\n                <StopsStripedList>\r\n                  {stopsList[activeList]?.Stops.map((stop) => (\r\n                    <li key={stop.StopID}>\r\n                      <span>{stop.StopName.Zh_tw}</span>\r\n                      <StopStatus>{stop.status}</StopStatus>\r\n                      {stop.BusPlate && <BusPlate>{stop.BusPlate}</BusPlate>}\r\n                    </li>\r\n                  ))}\r\n                </StopsStripedList>\r\n              </Board>\r\n            ) : (\r\n              <Board>\r\n                <Empty text=\"您還沒輸入路線資訊喔！\" />\r\n                <ClockText>{clock}</ClockText>\r\n              </Board>\r\n            )}\r\n          </div>\r\n        </SearchCol1>\r\n        <SearchCol2>\r\n          <RouteMap ref={ref} />\r\n        </SearchCol2>\r\n      </SearchWrapper>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Search;","import React, { createContext, useContext } from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nexport const LocationContext = createContext();\r\n\r\nexport const useLocationStore = () => useContext(LocationContext);\r\n\r\nexport const LocationContextProvider = ({ children }) => {\r\n  const [locationData, setLocationData] = React.useState(null);\r\n\r\n  return (\r\n    <LocationContext.Provider\r\n      value={{\r\n        locationData,\r\n        setLocationData,\r\n      }}\r\n    >\r\n      {children}\r\n    </LocationContext.Provider>\r\n  );\r\n};\r\n\r\nLocationContextProvider.propTypes = {\r\n  children: PropTypes.node.isRequired,\r\n};\r\n","export default __webpack_public_path__ + \"static/media/logo.1a9be860.svg\";","export default __webpack_public_path__ + \"static/media/ic-search.3aeba931.svg\";","export default __webpack_public_path__ + \"static/media/ic-map-pin.1994c556.svg\";","export default __webpack_public_path__ + \"static/media/ic-alert.d7a3da30.svg\";","export default __webpack_public_path__ + \"static/media/ic-search-grey.277928ec.svg\";","export default __webpack_public_path__ + \"static/media/ic-bus-main.922821e3.svg\";","export default __webpack_public_path__ + \"static/media/empty-card.79335666.svg\";","export default __webpack_public_path__ + \"static/media/dashed-line.5a0970dc.svg\";","export const apiRoot = 'https://ptx.transportdata.tw/MOTC';\r\nexport const desktopMedia = (styles) => (`@media (min-width: 1024px){${styles}}`);\r\n\r\nexport const colors = {\r\n  main: '#0077FF',\r\n  mainLight: '#ECEEFF',\r\n  secondary: '#FFC44E',\r\n  dark: '#1E222B',\r\n  tint: '#99BADD',\r\n  light: '#486AE8',\r\n  textDark: '#363636',\r\n  textMedium: '#7D7D7D',\r\n  textLight: '#B6B6B6',\r\n  textLighter: '#D9D9D9',\r\n};\r\n\r\nexport const directionText = {\r\n  E:'東行', W:'西行', S:'南行', N:'北行', SE:'東南行', NE:'東北行', SW:'西南行', NW:'西北行'\r\n};\r\n\r\nexport const auth = {\r\n  id: process.env.REACT_APP_TDXID,\r\n  key: process.env.REACT_APP_TDXKEY,\r\n  gMapKey: process.env.REACT_APP_GMAPKEY,\r\n  mapBoxToken: process.env.REACT_APP_MAPBOXTOKEN\r\n};\r\n\r\nexport const cities = [\r\n  {\r\n    name: '臺北市',\r\n    key: 'Taipei',\r\n    latlng: {lat: 25.04454809288478, lng: 121.53947779457634}\r\n  },\r\n  {\r\n    name: '新北市',\r\n    key: 'NewTaipei',\r\n    latlng: {lng: 121.4627838, lat: 25.0170177}\r\n  },\r\n  {\r\n    name: '桃園市',\r\n    key: 'Taoyuan',\r\n    latlng: {lng: 121.3009071, lat: 24.993682}\r\n  },\r\n  {\r\n    name: '臺中市',\r\n    key: 'Taichung',\r\n    latlng: {lng: 120.6736565, lat: 24.1477718}\r\n  },\r\n  {\r\n    name: '臺南市',\r\n    key: 'Tainan',\r\n    latlng: {lng: 120.2268219, lat: 22.9997997}\r\n  },\r\n  {\r\n    name: '高雄市',\r\n    key: 'Kaohsiung',\r\n    latlng: {lng: 120.3014088, lat: 22.6272419}\r\n  },\r\n  {\r\n    name: '基隆市',\r\n    key: 'Keelung',\r\n    latlng: {lng: 121.7391586, lat: 25.1275685}\r\n  },\r\n  {\r\n    name: '新竹市',\r\n    key: 'Hsinchu',\r\n    latlng: {lng: 120.9674549, lat: 24.813849}\r\n  },\r\n  {\r\n    name: '新竹縣',\r\n    key: 'HsinchuCounty',\r\n    latlng: {lng: 121.0177517, lat: 24.8386986}\r\n  },\r\n  {\r\n    name: '苗栗縣',\r\n    key: 'MiaoliCounty',\r\n    latlng: {lng: 120.8214569, lat: 24.5602388}\r\n  },\r\n  {\r\n    name: '彰化縣',\r\n    key: 'ChanghuaCounty',\r\n    latlng: {lng: 120.5161572, lat: 24.0517939}\r\n  },\r\n  {\r\n    name: '南投縣',\r\n    key: 'NantouCounty',\r\n    latlng: {lng: 120.9718323, lat: 23.9608425}\r\n  },\r\n  {\r\n    name: '雲林縣',\r\n    key: 'YunlinCounty',\r\n    latlng: {lng: 120.4313564, lat: 23.7092168}\r\n  },\r\n  {\r\n    name: '嘉義縣',\r\n    key: 'ChiayiCounty',\r\n    latlng: {lng: 120.2554893, lat: 23.4518294}\r\n  },\r\n  {\r\n    name: '嘉義市',\r\n    key: 'Chiayi',\r\n    latlng: {lng: 120.4491234, lat: 23.4800943}\r\n  },\r\n  {\r\n    name: '屏東縣',\r\n    key: 'PingtungCounty',\r\n    latlng: {lng: 120.5488586, lat: 22.5518792}\r\n  },\r\n  {\r\n    name: '宜蘭縣',\r\n    key: 'YilanCounty',\r\n    latlng: {lng: 121.7537498, lat: 24.7591271}\r\n  },\r\n  {\r\n    name: '花蓮縣',\r\n    key: 'HualienCounty',\r\n    latlng: {lng: 121.601572, lat: 23.9871544}\r\n  },\r\n  {\r\n    name: '臺東縣',\r\n    key: 'TaitungCounty',\r\n    latlng: {lng: 121.1438155, lat: 22.7613225}\r\n  },\r\n  {\r\n    name: '金門縣',\r\n    key: 'KinmenCounty',\r\n    latlng: {lng: 118.3766556, lat: 24.4493374}\r\n  },\r\n  {\r\n    name: '澎湖縣',\r\n    key: 'PenghuCounty',\r\n    latlng: {lng: 119.5793152, lat: 23.5712249}\r\n  },\r\n  {\r\n    name: '連江縣',\r\n    key: 'LienchiangCounty',\r\n    latlng: {lng: 119.9516487, lat: 26.1602145}\r\n  },\r\n];","import styled from 'styled-components';\r\nimport icSearch from '@/images/ic-search-grey.svg';\r\nimport icBus from '@/images/ic-bus-main.svg';\r\nimport emptyBg from '@/images/empty-card.svg';\r\nimport dashedBorder from '@/images/dashed-line.svg';\r\nimport { Link } from 'react-router-dom';\r\nimport { colors, desktopMedia } from '@/const';\r\n\r\n// Common\r\n\r\nexport const Container = styled.div`\r\nmin-height: 100vh;\r\n${desktopMedia(`\r\ndisplay: flex;\r\n`)}\r\n`;\r\n\r\nexport const PageWrapper = styled.div`\r\npadding: 25px 26px 40px;\r\nflex: 1;\r\n${desktopMedia(`\r\npadding: 46px 82px 67px;\r\nmax-height: 100vh;\r\noverflow-y: scroll;\r\n&::-webkit-scrollbar {\r\n  width: 12px;\r\n}\r\n&::-webkit-scrollbar-thumb {\r\n  border-radius: 8px;\r\n  background: rgba(72,106,232,0.5);\r\n  border: 2px solid #F5F6FF;\r\n}\r\n`)}\r\n`;\r\n\r\nexport const PageTitle = styled.h1`\r\nfont-size: 16px;\r\ntext-transform: uppercase;\r\ncolor: var(--light);\r\nwidth: 100%;\r\n${desktopMedia(`\r\nfont-size: 26px;\r\nletter-spacing: 1.5px;\r\nwidth: auto;\r\n`)}`;\r\n\r\nexport const SecondTitle = styled.h2`\r\nfont-size: 20px;\r\ncolor: var(--text-medium);\r\nmargin-bottom: 1.5em;\r\n`;\r\n\r\nexport const ItemTitle = styled.h3`\r\ncolor: var(--light);\r\nfont-size: 18px;\r\nmargin-bottom: 0.5em;\r\n`;\r\n\r\nexport const TitleSplit = styled.hr`\r\nborder: 0;\r\nmargin: 0 0.5em;\r\nborder-right: 2px solid var(--light);\r\ndisplay: inline-block;\r\nvertical-align: -2px;\r\nheight: 0.8em;\r\n${desktopMedia(`\r\nborder-right-width: 3px;\r\n`)}\r\n`\r\n\r\nexport const Board = styled.div`\r\nposition: relative;\r\nbackground: #FFFFFF;\r\nbox-shadow: 2px 4px 7px rgba(196, 196, 196, 0.11);\r\nborder-radius: 16px;\r\noverflow: hidden;\r\n`;\r\n\r\nexport const StripedList = styled.ul`\r\n> li {\r\n  line-height: 1.7;\r\n  > a {\r\n    display: block;\r\n    padding: 24px 20px;\r\n    font-weight: 500;\r\n    color: var(--text-medium);\r\n    font-size: 14px;\r\n    ${desktopMedia(`\r\n      padding: 24px 70px;\r\n      font-size: 18px;\r\n    `)}\r\n  }\r\n  &:nth-child(odd) {\r\n    background: #F6F7FF;\r\n  }\r\n  &:nth-child(even) {\r\n    background: #ECEEFF;\r\n  }\r\n   + li {\r\n    margin-top: 2px;\r\n  }\r\n}\r\nmax-height: calc(100vh - 380px);\r\noverflow-y: scroll;\r\n&::-webkit-scrollbar {\r\n  width: 6px;\r\n}\r\n&::-webkit-scrollbar-track {\r\n  background: #F6F7FF;\r\n}\r\n&::-webkit-scrollbar-thumb {\r\n  background: var(--light);\r\n  border-radius: 6px;\r\n  &:hover {\r\n    background: var(--tint);\r\n  }\r\n}\r\n`;\r\n\r\nexport const StopsStripedList = styled.ul`\r\nmax-height: calc(100% - 40px);\r\noverflow-y: scroll;\r\n&::-webkit-scrollbar {\r\n  width: 5px;\r\n}\r\n&::-webkit-scrollbar-track {\r\n  background: #F6F7FF;\r\n}\r\n&::-webkit-scrollbar-thumb {\r\n  background: #C4C4C4;\r\n  &:hover {\r\n    background: var(--text-medium);\r\n  }\r\n}\r\n> li {\r\n  line-height: 1.7;\r\n  font-size: 14px;\r\n  display: grid;\r\n  grid-template-columns: 1fr 80px 90px;\r\n  grid-column-gap: 12px;\r\n  padding: 0.25em 1.5em;\r\n  align-items: center;\r\n  &:nth-child(odd) {\r\n    background: #F2F2F2;\r\n  }\r\n  &:nth-child(even) {\r\n    background: #FEFCFC;\r\n  }\r\n}\r\n`;\r\n\r\nexport const StopStatus = styled.span`\r\nfont-weight: bold;\r\nletter-spacing: 0.05em;\r\ntext-align: center;\r\ncolor: ${({children}) => {\r\n  switch (children) {\r\n    case '進站中':\r\n      return 'var(--secondary)';\r\n    case '末班車已過':\r\n    case '尚未發車':\r\n      return 'var(--text-medium)';\r\n    default:\r\n      return 'var(--light)';\r\n  }\r\n}};\r\n`;\r\n\r\nexport const BusPlate = styled.span`\r\nfont-size: 12px;\r\ncolor: var(--light);\r\npadding-left: 32px;\r\nbackground: url(${icBus}) 12px center/11px no-repeat;\r\n`;\r\n\r\nexport const TabList = styled.ul`\r\ndisplay: flex;\r\nwidth: 100%;\r\n> li {\r\n  flex: 1;\r\n  padding: 0.75em 1em;\r\n  font-size: ${({size}) => size === 'small' ? '14px' : '18px'};\r\n  font-weight: bold;\r\n  background-color: #BFCDFF;\r\n  white-space: nowrap;\r\n  color: #fff;\r\n  text-align: center;\r\n  cursor: pointer;\r\n  &.active {\r\n    background-color: var(--light);\r\n    cursor: default;\r\n  }\r\n  &:first-child {\r\n    border-top-left-radius: 16px;\r\n  }\r\n  &:last-child {\r\n    border-top-right-radius: 16px;\r\n  }\r\n}\r\n`;\r\n\r\n// Menu\r\nexport const MenuWrapper = styled.div`\r\nbox-shadow: 3px 2px 6px rgba(121, 121, 121, 0.25);\r\nbackground: var(--light);\r\ndisplay: flex;\r\njustify-content: space-between;\r\nalign-items: center;\r\n${desktopMedia(`\r\nborder-radius: 16px;\r\ndisplay: block;\r\n`)}\r\n`;\r\n\r\nexport const LinkLogo = styled(Link)`\r\npadding: 14px;\r\ndisplay: block;\r\n> img {\r\n  width: 70px;\r\n}\r\n${desktopMedia(`\r\nborder-bottom: 1px solid rgba(255, 255, 255, 0.5);\r\npadding: 40px 20px;\r\n> img {\r\n  width: 100px;\r\n}\r\n`)}\r\n`;\r\n\r\nexport const NavList = styled.ul`\r\ndisplay: flex;\r\nalign-items:center;\r\n${desktopMedia(`\r\nflex-direction: column;\r\n`)}\r\n`;\r\n\r\nexport const NavListItem = styled.li`\r\nmargin-right: 16px;\r\n${desktopMedia(`\r\nmargin-top: 38px;\r\nmargin-right: 0;\r\n`)}\r\n`;\r\n\r\nexport const NavLink = styled(Link)`\r\ndisplay: flex;\r\nalign-items: center;\r\njustify-content: center;\r\nwidth: 40px;\r\nheight: 40px;\r\nborder-radius: 16px;\r\n> img {\r\n  width: 24px;\r\n}\r\n&.active, &:hover {\r\n  background-color: #2A4AC2;\r\n}\r\n${desktopMedia(`\r\nwidth: 62px;\r\nheight: 62px;\r\n> img {\r\n  width: auto;\r\n}\r\n`)}\r\n`;\r\n\r\n// Modal\r\n\r\nexport const Overlay = styled.div`\r\nposition: fixed;\r\nleft: 0;\r\ntop: 0;\r\nright: 0;\r\nbottom: 0;\r\nbackground: #486ae880;\r\nz-index: 1000;\r\n`;\r\n\r\nexport const ModalWrapper = styled.div`\r\noverflow-y: scroll;\r\nheight: 100vh;\r\nwidth: 100%;\r\ndisplay: flex;\r\nalign-items: center;\r\njustify-content: center;\r\n&::-webkit-scrollbar {\r\n  width: 0;\r\n}\r\n`;\r\n\r\nexport const Modal = styled.div`\r\nborder-radius: 16px;\r\nbackground: #fff;\r\npadding: 20px;\r\nmargin: 20px;\r\nwidth: 600px;\r\n${desktopMedia(`\r\npadding: 24px 36px;\r\n`)}\r\n`;\r\n\r\nexport const MapContainer = styled.div`\r\nheight: 360px;\r\nborder-radius: 16px;\r\nmargin-top: 20px;\r\n`;\r\n\r\n// Quick Search\r\n\r\nexport const SearchInput = styled.input`\r\noutline: none;\r\nwidth: 100%;\r\nfont-family: inherit;\r\nbackground: url(${icSearch}) right 24px center/18px no-repeat, #ffffff;\r\nbox-shadow: 4px 4px 25px rgba(148, 148, 148, 0.25);\r\nborder-radius: 16px;\r\nborder: 0;\r\npadding: 8px 24px 8px 12px;\r\ntext-align: center;\r\ncolor: var(--text-dark);\r\n&::placeholder {\r\n  color: var(--text-medium);\r\n}\r\n${desktopMedia(`\r\nfont-size: 18px;\r\npadding: 12px 30px 12px 12px;\r\nbackground-size: 22px;\r\n`)}\r\n`\r\n\r\nexport const DropdownWrapper = styled.div`\r\n  position: relative;\r\n  display: inline-block;\r\n  width: 100%;\r\n  ${desktopMedia(`\r\n    width: 300px;\r\n  `)}\r\n`;\r\n\r\nexport const DropdownList = styled.ul`\r\n  position: absolute;\r\n  z-index: 1001;\r\n  top: calc(100% + 16px);\r\n  box-shadow: 4px 4px 25px rgba(148, 148, 148, 0.25);\r\n  border-radius: 16px;\r\n  overflow: hidden;\r\n  list-style: none;\r\n  padding: 0;\r\n  margin: 0;\r\n  width: 100%;\r\n  max-height: 140px;\r\n  overflow-y: scroll;\r\n  &::-webkit-scrollbar {\r\n    width: 8px;\r\n  }\r\n  &::-webkit-scrollbar-thumb {\r\n    background: ${colors.light};\r\n    border-radius: 6px;\r\n    border: 2px solid #F5F6FF;\r\n  }\r\n  &::-webkit-scrollbar-track {\r\n    background: #ffffff;\r\n    border: 2px solid #F5F6FF;\r\n  }\r\n`;\r\n\r\nexport const DropdownListItem = styled.li`\r\n font-size: 18px;\r\n padding: 12px;\r\n text-align: center;\r\n cursor: pointer;\r\n background: #fff;\r\n &:nth-child(odd) {\r\n  background: #F5F6FF;\r\n }\r\n &:hover {\r\n  background: ${colors.mainLight};\r\n }\r\n`;\r\n\r\n// Empty\r\n\r\nexport const EmptyWrapper = styled.div`\r\ntext-align: center;\r\nbackground: url(${emptyBg}) center bottom 10%/cover no-repeat;\r\nheight: 30vw;\r\nmin-height: 240px;\r\nmax-height: 340px;\r\npadding: 60px 30px;\r\n`;\r\n\r\nexport const EmptyText = styled.div`\r\ncolor: #bfcdff;\r\nfont-size: 18px;\r\nletter-spacing: 0.05em;\r\n`;\r\n\r\n// Search\r\n\r\nexport const TitleWithSearch = styled.div`\r\ndisplay: flex;\r\nalign-items:center;\r\nflex-wrap: wrap;\r\njustify-content: flex-end;\r\nmargin-bottom: 16px;\r\n${DropdownWrapper} {\r\n  width: 160px;\r\n  margin-bottom: 10px;\r\n}\r\n${desktopMedia(`\r\njustify-content: space-between;\r\n> h1 {\r\n  order: -1;\r\n}\r\n${DropdownWrapper} {\r\n  width: 310px;\r\n  margin-bottom: 0px;\r\n}\r\n`)}\r\n`;\r\n\r\nexport const SearchWrapper = styled.div`\r\n${desktopMedia(`\r\nheight: calc(100vh - 200px);\r\nmin-height: 650px;\r\ndisplay:flex;\r\n`)}\r\n`;\r\n\r\nexport const SearchCol1 = styled.div`\r\nflex-basis: 380px;\r\ndisplay: flex;\r\nflex-direction: column;\r\nmargin-bottom: 28px;\r\n${desktopMedia(`\r\nmargin-right: 28px;\r\nmargin-bottom: 0px;\r\n`)}\r\n> div {\r\n  flex: 1;\r\n  max-height:calc(50% - 14px);\r\n  > div {\r\n    height: 100%;\r\n  }\r\n  &:first-child {\r\n    margin-bottom: 28px;\r\n  }\r\n}\r\n${EmptyWrapper} {\r\n  height: 100%;\r\n  min-height: 240px;\r\n  max-height: none;\r\n  padding: 40px 20px;\r\n${desktopMedia(`\r\n  min-height: auto;\r\n`)}\r\n}\r\n`;\r\n\r\nexport const SearchCol2 = styled.div`\r\nflex: 1;\r\n`;\r\n\r\nexport const ClockText = styled.div`\r\nposition: absolute;\r\nleft: 50%;\r\ntop: 30%;\r\ntransform: translate(-50%, 0);\r\nfont-size: 72px;\r\ncolor: #fff;\r\n`;\r\n\r\nexport const SearchFieldWrapper = styled.div`\r\ndisplay: flex;\r\nalign-items: center;\r\npadding: 12px 6px;\r\nposition: relative;\r\n+ div {\r\n  border-top: 1px dashed transparent;\r\n  border-image: url('${dashedBorder}') 1 1 round;\r\n}\r\n> img {\r\n  width: 20px;\r\n  margin-right: 16px;\r\n}\r\n&:after{\r\n  content: '';\r\n  border-top: 11px solid var(--text-light);\r\n  border-left: 8px solid transparent;\r\n  border-right: 8px solid transparent;\r\n  position: absolute;\r\n  top: 50%;\r\n  margin-top: -6px;\r\n  right: 32px;\r\n  z-index: 1;\r\n}\r\n${DropdownList} {\r\n  top: calc(100% - 4px);\r\n  max-height: 125px;\r\n  max-width: 230px;\r\n}\r\n${DropdownListItem} {\r\n  padding: 8px 12px;\r\n}\r\n${SearchInput} {\r\n  background: none;\r\n  box-shadow: none;\r\n  font-weight: bold;\r\n  text-align: left;\r\n  font-size: 14px;\r\n  color: var(--text-dark);\r\n  &::placeholder {\r\n    color: var(--text-light);\r\n  }\r\n}\r\n`;\r\n\r\nexport const SearchBtn = styled.button`\r\nborder-radius: 20px;\r\nbackground: var(--light);\r\ntext-align: center;\r\ncolor: #fff;\r\npadding: 0.5em 1em;\r\nfont-weight: bold;\r\nfont-size: 16px;\r\nborder: 0;\r\nwidth: 90%;\r\ndisplay: block;\r\nmargin: 1em auto 0;\r\ncursor: pointer;\r\n`;\r\n\r\nexport const RouteMap = styled.div`\r\nheight: 100%;\r\nmin-height: 360px;\r\nbox-shadow: 1px 4px 15px rgba(140, 140, 140, 0.25);\r\nborder-radius: 16px;\r\n.icon-number {\r\n  width: 24px;\r\n  height: 24px;\r\n  border-radius: 50%;\r\n  border: 2px solid #fff;\r\n  background: var(--light);\r\n  color: #fff;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  font-weight: bold;\r\n  box-shadow: 2px 4px 4px rgba(0, 0, 0, 0.25);\r\n}\r\n`;","import Logo from '@/images/logo.svg';\r\nimport icSearch from '@/images/ic-search.svg';\r\nimport icMapPin from '@/images/ic-map-pin.svg';\r\nimport icAlert from '@/images/ic-alert.svg';\r\nimport {MenuWrapper, LinkLogo, NavList, NavListItem, NavLink} from '@/style';\r\n\r\nconst Menu = () => (\r\n  <MenuWrapper>\r\n    <LinkLogo to=\"/\"><img src={Logo} /></LinkLogo>\r\n    <NavList>\r\n      <NavListItem>\r\n        <NavLink to=\"nearby\"><img src={icMapPin} /></NavLink>\r\n      </NavListItem>\r\n      <NavListItem>\r\n        <NavLink to=\"search\"><img src={icSearch} /></NavLink>\r\n      </NavListItem>\r\n      <NavListItem>\r\n        <NavLink to=\"news\"><img src={icAlert} /></NavLink>\r\n      </NavListItem>\r\n    </NavList>\r\n  </MenuWrapper>\r\n);\r\n\r\nexport default Menu;","export default __webpack_public_path__ + \"static/media/ic-point.821431dd.svg\";","export default __webpack_public_path__ + \"static/media/ic-map-marker.5470742b.svg\";","import React from 'react';\r\nimport axios from 'axios';\r\nimport jsSHA from \"jssha\";\r\nimport { apiRoot, auth } from \"@/const\";\r\nimport { useLocationStore } from \"@/store/locationStore\";\r\n\r\nconst checkIsMobile = () => {\r\n  if (typeof window === 'undefined') {\r\n    return true;\r\n  }\r\n  return window.innerWidth < 1024;\r\n};\r\n\r\nexport const useIsMobile = () => {\r\n  // Initialize the desktop size to an accurate value on initial state set\r\n  const [isMobileSize, setIsMobileSize] = React.useState(false);\r\n\r\n  React.useEffect(() => {\r\n    if (typeof window === 'undefined') {\r\n      return;\r\n    }\r\n\r\n    const autoResize = () => {\r\n      setIsMobileSize(checkIsMobile());\r\n    }\r\n\r\n    window.addEventListener('resize', autoResize);\r\n\r\n    autoResize();\r\n\r\n    // Return a function to disconnect the event listener\r\n    return () => window.removeEventListener('resize', autoResize);\r\n  }, [])\r\n\r\n  return isMobileSize;\r\n};\r\n\r\nexport const useIsMobileEnv = () => {\r\n  const [isMobileEnv, setIsMobileEnv] = React.useState(false);\r\n\r\n  React.useEffect(() => {\r\n    if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {\r\n      setIsMobileEnv(true);\r\n    }\r\n  }, [])\r\n\r\n  return isMobileEnv;\r\n};\r\n\r\nconst genHMAC = () => {\r\n  const GMTString = new Date().toGMTString();\r\n  const ShaObj = new jsSHA('SHA-1', 'TEXT');\r\n  ShaObj.setHMACKey(auth.key, 'TEXT');\r\n  ShaObj.update(`x-date: ${GMTString}`);\r\n  const HMAC = ShaObj.getHMAC('B64');\r\n  return { HMAC, GMTString };\r\n};\r\n\r\nexport const commonAxios = async ({\r\n  method = 'get',\r\n  url,\r\n  ...others\r\n}) => {\r\n  const { HMAC, GMTString } = genHMAC();\r\n  let responseData = null;\r\n  try {\r\n    const { data } = await axios({\r\n      method,\r\n      url: `${apiRoot}${url}&$format=JSON`,\r\n      responseType: 'json',\r\n      headers: {\r\n        Authorization: `hmac username=\"${auth.id}\", algorithm=\"hmac-sha1\", headers=\"x-date\", signature=\"${HMAC}\"`,\r\n        'x-date': GMTString,\r\n      },\r\n      ...others\r\n    });\r\n    responseData = data;\r\n  } catch (err) {\r\n    console.log('api error: ', err);\r\n  }\r\n  return responseData;\r\n};\r\n\r\nexport const useCurrentPosition = () => {\r\n  const { locationData, setLocationData } = useLocationStore();\r\n\r\n  const getPosition = () => {\r\n    navigator.geolocation.getCurrentPosition((res) => {\r\n      setLocationData({ lat: res.coords.latitude, lng: res.coords.longitude });\r\n    });\r\n  };\r\n\r\n  return {\r\n    locationData,\r\n    getPosition\r\n  }\r\n};","import React from 'react';\r\nimport {useNavigate} from 'react-router-dom';\r\n// import PropTypes from 'prop-types';\r\nimport { SearchInput, DropdownWrapper, DropdownList, DropdownListItem } from '@/style';\r\nimport {commonAxios} from '@/common';\r\n\r\nconst StyledSelect = () => {\r\n  const navigate = useNavigate();\r\n  const [options, setOptions] = React.useState([]);\r\n  const [showDropdown, setShowDropdown] = React.useState(false);\r\n  const inputRef = React.useRef(null);\r\n\r\n  const searchRoutes = (keyword) => {\r\n    commonAxios({\r\n      url: `/v2/Bus/Route/City/Taipei/${keyword}?$top=10`,\r\n    }).then((res) => {\r\n      setOptions(res?.map((n) => ({value: n.RouteUID, label: n.RouteName.Zh_tw})).sort((a, b) => a.label.localeCompare(b.label)));\r\n    });\r\n  };\r\n  const onChange = (e) => {\r\n    if (e.target.value) {\r\n      searchRoutes(e.target.value);\r\n    } else {\r\n      setOptions([]);\r\n    }\r\n  };\r\n  const onListSelect = (val) => {\r\n    navigate(`/search/Taipei/${val}`);\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    const root = document.getElementById('root');\r\n    const onOtherClick = (e) => {\r\n      if (e.target !== inputRef.current) {\r\n        setShowDropdown(false);\r\n      }\r\n    };\r\n    if (showDropdown) {\r\n      root.addEventListener('click', onOtherClick);\r\n    }\r\n    return () => {\r\n      root.removeEventListener('click', onOtherClick);\r\n    }\r\n  }, [showDropdown]);\r\n\r\n  React.useEffect(() => {\r\n    if (options.length > 0) {\r\n      setShowDropdown(true);\r\n    }\r\n  }, [options]);\r\n\r\n  return (\r\n    <DropdownWrapper>\r\n      <SearchInput ref={inputRef} type=\"text\" placeholder=\"快速搜尋\" onChange={onChange} onFocus={() => setShowDropdown(true)} />\r\n      {showDropdown && (\r\n        <DropdownList>\r\n          {options.map((opt) => <DropdownListItem key={opt.label} onClick={() => onListSelect(opt.value)}>{opt.label}</DropdownListItem>)}\r\n        </DropdownList>\r\n      )}\r\n    </DropdownWrapper>\r\n  );\r\n};\r\n\r\nexport default StyledSelect;\r\n\r\n// StyledSelect.propTypes = {\r\n//   defaultValue: PropTypes.string.isRequired,\r\n//   options: PropTypes.array.isRequired,\r\n//   onSelect: PropTypes.func.isRequired\r\n// };\r\n","import React from 'react';\r\n// import PropTypes from 'prop-types';\r\nimport { SearchFieldWrapper, SearchInput, DropdownWrapper, DropdownList, DropdownListItem } from '@/style';\r\n\r\nconst SearchSelect = ({options, placeholder, onSelect, icon}) => {\r\n  const [inputValue, setInputValue] = React.useState('');\r\n  const [showDropdown, setShowDropdown] = React.useState(false);\r\n  const [filterOptions, setFilterOptions] = React.useState([]);\r\n  const inputRef = React.useRef(null);\r\n\r\n  const onChange = (e) => {\r\n    setInputValue(e.target.value);\r\n    setShowDropdown(true);\r\n    if (e.target.value) {\r\n      setFilterOptions(options.filter((n) => n.label.includes(e.target.value)));\r\n    } else {\r\n      setFilterOptions(options);\r\n    }\r\n  };\r\n\r\n  const onListClick = (option) => {\r\n    setInputValue(option.label);\r\n    onSelect(option.value);\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    const root = document.getElementById('root');\r\n    const onOtherClick = (e) => {\r\n      if (e.target !== inputRef.current) {\r\n        setShowDropdown(false);\r\n      }\r\n    };\r\n    if (showDropdown) {\r\n      root.addEventListener('click', onOtherClick);\r\n    }\r\n    return () => {\r\n      root.removeEventListener('click', onOtherClick);\r\n    }\r\n  }, [showDropdown]);\r\n\r\n  React.useEffect(() => {\r\n    if (options.length > 0) {\r\n      setFilterOptions(options);\r\n    }\r\n  }, [options]);\r\n\r\n  return (\r\n    <SearchFieldWrapper>\r\n      <img src={icon} alt=\"\" />\r\n      <DropdownWrapper>\r\n        <SearchInput\r\n          ref={inputRef}\r\n          type=\"text\"\r\n          value={inputValue}\r\n          placeholder={placeholder}\r\n          onChange={onChange}\r\n          onFocus={() => setShowDropdown(true)}\r\n          autocomplete=\"off\"\r\n        />\r\n        {showDropdown && (\r\n          <DropdownList>\r\n            {filterOptions.map((opt) => <DropdownListItem key={opt.label} onClick={() => onListClick(opt)}>{opt.label}</DropdownListItem>)}\r\n          </DropdownList>\r\n        )}\r\n      </DropdownWrapper>\r\n    </SearchFieldWrapper>\r\n  );\r\n};\r\n\r\nexport default SearchSelect;\r\n\r\n// SearchSelect.propTypes = {\r\n//   defaultValue: PropTypes.string.isRequired,\r\n//   options: PropTypes.array.isRequired,\r\n//   onSelect: PropTypes.func.isRequired\r\n// };\r\n","import bus from '@/images/ic-bus-main.svg';\r\nimport { EmptyWrapper, EmptyText } from '@/style';\r\n\r\nconst Empty = ({text = '沒有資料'}) => (\r\n  <EmptyWrapper>\r\n    <EmptyText>{text}</EmptyText>\r\n  </EmptyWrapper>  \r\n);\r\n\r\nexport default Empty;","import React from 'react';\r\nimport L from 'leaflet';\r\nimport { useLocationStore } from '@/store/locationStore';\r\nimport { auth, directionText } from \"@/const\";\r\nimport userMarker from \"@/images/user-marker.svg\";\r\nimport mapMarker from \"@/images/ic-map-marker-main.svg\";\r\nimport {ItemTitle, Overlay, ModalWrapper, Modal, MapContainer} from '@/style';\r\n\r\nlet map;\r\n\r\nconst StationModal = ({data, close}) => {\r\n  const ref = React.useRef();\r\n  const {locationData} = useLocationStore();\r\n  const initMap = (config, ele) => {\r\n    const { PositionLat: lat, PositionLon: lng } = config;\r\n    const mymap = L.map(ele).setView([lat, lng], 15);\r\n  \r\n    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {\r\n      attribution: 'Map data &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, Imagery © <a href=\"https://www.mapbox.com/\">Mapbox</a>',\r\n      maxZoom: 18,\r\n      id: 'allychen/ckw5waap41dl514o4rcpa1nsn',\r\n      tileSize: 512,\r\n      zoomOffset: -1,\r\n      accessToken: auth.mapBoxToken\r\n    }).addTo(mymap);\r\n\r\n    L.marker([lat, lng], {\r\n      icon: L.icon({\r\n        iconUrl: mapMarker,\r\n        iconAnchor: [10, 23],\r\n        popupAnchor: [0, -23]\r\n      })\r\n    }).addTo(mymap);\r\n    // L.marker([lat, lng]).addTo(mymap);\r\n    if (locationData) {\r\n      L.marker([locationData.lat, locationData.lng], {\r\n        icon: L.icon({\r\n          iconUrl: userMarker,\r\n          iconAnchor: [15, 34],\r\n          popupAnchor: [0, -34]\r\n        })\r\n      }).addTo(mymap);\r\n    }\r\n  \r\n    return mymap;\r\n  };\r\n  React.useEffect(() => {\r\n    map = initMap(data.StationPosition, ref.current);\r\n    return () => {\r\n      map.remove();\r\n    }\r\n  }, []);\r\n  return (\r\n    <Overlay onClick={close}>\r\n      <ModalWrapper>\r\n        <Modal onClick={(e) => e.stopPropagation()}>\r\n          <ItemTitle>{data.StationName.Zh_tw} - {directionText[data.Bearing]}</ItemTitle>\r\n          行經路線：{data.Stops.map((s) => s.RouteName.Zh_tw).join(', ')}\r\n          <MapContainer ref={ref} />\r\n        </Modal>\r\n      </ModalWrapper>\r\n    </Overlay>\r\n  );\r\n};\r\n\r\nexport default StationModal;","export default __webpack_public_path__ + \"static/media/user-marker.832aa249.svg\";","export default __webpack_public_path__ + \"static/media/ic-map-marker-main.dfbf20a3.svg\";","import React from 'react';\r\nimport {Link} from 'react-router-dom';\r\nimport {PageTitle, TitleSplit, SecondTitle, Board, StripedList, ItemTitle, TabList, TitleWithSearch} from '@/style';\r\nimport {commonAxios, useCurrentPosition, useIsMobile} from '@/common';\r\nimport StationModal from \"@/components/StationModal\";\r\nimport QuickSearch from '@/components/QuickSearch';\r\nimport Empty from \"@/components/Empty\";\r\n\r\nconst Nearby = () => {\r\n  const [currentDistance, setCurrentDistance] = React.useState(300);\r\n  const [data, setData] = React.useState([]);\r\n  const [modalInfo, setModalInfo] = React.useState(null);\r\n  const { locationData, getPosition } = useCurrentPosition();\r\n  const isMobile = useIsMobile();\r\n\r\n  const getNearStations = ({lat, lng, distance}) => {\r\n    commonAxios({\r\n      url: `/v2/Bus/Station/NearBy?$spatialFilter=nearby(${lat},${lng},${distance})`,\r\n    }).then((res) => {\r\n      setData(res.filter((n, i, arr) => arr.findIndex((x) => x.StationID === n.StationID) === i));\r\n    });\r\n  };\r\n\r\n  const showModal = (e, info) => {\r\n    e.preventDefault();\r\n    setModalInfo(info);\r\n  };\r\n\r\n  const closeModal = () => {\r\n    setModalInfo(null);\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    getPosition();\r\n  }, []);\r\n\r\n  React.useEffect(() => {\r\n    if (locationData && currentDistance) {\r\n      getNearStations({...locationData, distance: currentDistance});\r\n    }\r\n  }, [locationData, currentDistance]);\r\n\r\n  return (\r\n    <>\r\n      <TitleWithSearch>\r\n        <QuickSearch />\r\n        <PageTitle>Bus Stop <TitleSplit /> 附近站牌</PageTitle>\r\n      </TitleWithSearch>\r\n      <Board style={{padding: isMobile ? '40px 30px' : '50px 70px', marginTop: 20}}>\r\n        <SecondTitle>附近的站牌</SecondTitle>\r\n        <TabList>\r\n          <li className={currentDistance === 300 ? 'active' : ''} onClick={() => setCurrentDistance(300)}>\r\n            300 m\r\n          </li>\r\n          <li className={currentDistance === 10 ? 'active' : ''} onClick={() => setCurrentDistance(10)}>\r\n            100 m\r\n          </li>\r\n        </TabList>\r\n        {data.length > 0 ? (\r\n          <StripedList>\r\n            {data.map((n, i) => (\r\n              <li key={n.StationUID}>\r\n                <Link to=\"#\" onClick={(e) => showModal(e, n)}>\r\n                  <ItemTitle>{n.StationName?.Zh_tw} ({n.Bearing})</ItemTitle>\r\n                  {n?.Stops?.map((s) => s?.RouteName?.Zh_tw).join(', ')}\r\n                </Link>\r\n              </li>\r\n            ))}\r\n          </StripedList>\r\n          ) : <Empty text=\"附近沒有站牌\" />}\r\n      </Board>\r\n      {modalInfo && (\r\n        <StationModal data={modalInfo} close={closeModal} />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Nearby;","import {PageTitle, TitleSplit} from '@/style';\r\n\r\nconst Search = () => {\r\n  return (\r\n    <PageTitle>Latest News <TitleSplit /> 最新消息</PageTitle>\r\n  );\r\n};\r\n\r\nexport default Search;","import {\r\n  HashRouter as Router,\r\n  Routes,\r\n  Route,\r\n  Outlet\r\n} from \"react-router-dom\";\r\nimport { LocationContextProvider } from '@/store/locationStore';\r\nimport Menu from \"@/components/Menu\";\r\nimport Search from \"@/containers/Search\";\r\nimport Nearby from \"@/containers/Nearby\";\r\nimport News from \"@/containers/News\";\r\nimport { Container, PageWrapper } from \"./style\";\r\n\r\nconst Layout = () => (\r\n  <Container>\r\n    <Menu />\r\n    <PageWrapper>\r\n      <Outlet />\r\n    </PageWrapper>\r\n  </Container>\r\n);\r\n\r\nconst App = () => {\r\n  return (\r\n    <LocationContextProvider>\r\n      <Router>\r\n        <Routes>\r\n          <Route path=\"/\" element={<Layout />}>\r\n            <Route path=\"search\">\r\n              <Route path=\":city\" element={<Search />} />\r\n              <Route path=\":city/:route\" element={<Search />} />\r\n              <Route index element={<Search />} />\r\n            </Route>\r\n            <Route path=\"nearby\" element={<Nearby />} />\r\n            <Route path=\"news\" element={<News />} />\r\n            <Route index element={<Search />} />\r\n          </Route>\r\n          {/* <Route path=\"/*\" element={<NotFound />} /> */}\r\n        </Routes>\r\n      </Router>\r\n    </LocationContextProvider>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}